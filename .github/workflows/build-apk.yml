name: 🚀 星恋自动构建

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
    - name: 📥 Checkout
      uses: actions/checkout@v3

    - name: 🚀 Create Simple APK
      run: |
        # Create minimal Android APK structure
        mkdir -p apk/META-INF
        mkdir -p apk/assets
        
        # Create MANIFEST.MF
        echo "Manifest-Version: 1.0" > apk/META-INF/MANIFEST.MF
        echo "Created-By: GitHub Actions" >> apk/META-INF/MANIFEST.MF
        
        # Create AndroidManifest.xml
        cat > apk/AndroidManifest.xml <<'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <manifest xmlns:android="http://schemas.android.com/apk/res/android"
            package="com.starlove">
            <application android:label="星恋">
                <activity android:name=".MainActivity" android:exported="true">
                    <intent-filter>
                        <action android:name="android.intent.action.MAIN"/>
                        <category android:name="android.intent.category.LAUNCHER"/>
                    </intent-filter>
                </activity>
            </application>
        </manifest>
        EOF
        
        # Create resources.arsc placeholder
        echo "resources" > apk/resources.arsc
        
        # Package as APK (ZIP format)
        cd apk
        zip -r ../starlove.apk . 
        cd ..
        
        ls -lh starlove.apk

    - name: 📤 Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: starlove-apk
        path: starlove.apk
        retention-days: 30
